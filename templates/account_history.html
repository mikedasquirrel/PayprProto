{% extends "layout.html" %}{% block content %}
<section class="sheet">
  <h2>History</h2>
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px">
    <div class="small-note">Totals are for all time.</div>
    <a class="pay-btn" href="/pub/export.csv" style="text-decoration:none">Export CSV</a>
  </div>
  <table class="tx-table">
    <thead>
      <tr><th>Date</th><th>Publisher</th><th>Type</th><th>Price</th><th>Fee</th><th>Net</th><th>Split</th></tr>
    </thead>
    <tbody>
    {% for e in entries %}
      {% set t = e.t %}
      <tr>
        <td>{{ t.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ t.publisher.name if t.publisher else '' }}</td>
        <td>{{ t.type }}</td>
        <td>${{ (t.price_cents/100) | round(2) }}</td>
        <td>${{ (t.fee_cents/100) | round(2) }}</td>
        <td>${{ (t.net_cents/100) | round(2) }}</td>
        <td>
          {% if e.split %}
            {% for k,v in e.split.items() %}<span class="chip">{{ k }} ${{ (v/100) | round(2) }}</span> {% endfor %}
          {% else %}
            <span class="small-note">â€”</span>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
