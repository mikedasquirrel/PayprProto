{% extends "layout.html" %}{% block content %}
<section class="sheet" style="max-width:880px">
  <h1 class="headline">Bookmarklet</h1>
  <p class="dek">Drag this to your bookmarks bar. On any article page, click it to open Paypr in a small overlay pointed at your newsstand. It’s a quick gateway to top up and unlock in seconds.</p>

  <div style="margin:14px 0">
    <a class="pay-btn" id="bm-link" href="javascript:(function(){window.open('%2F','paypr','width=420,height=640,menubar=no,toolbar=no,location=no,status=no');})();" style="text-decoration:none">Paypr Newsstand</a>
    <button class="pay-btn" id="bm-copy" style="background:var(--accent2); color:#0f1115; margin-left:8px">Copy code</button>
  </div>

  <details style="margin-top:12px">
    <summary>View code</summary>
    <pre id="bm-code" style="white-space:pre-wrap; background:rgba(10,12,18,.6); padding:12px; border-radius:10px">javascript:(function(){window.open('%2F','paypr','width=420,height=640,menubar=no,toolbar=no,location=no,status=no');})();</pre>
  </details>

  <h3 style="margin-top:20px">External site integration (beta)</h3>
  <p class="card-dek">To embed a Pay button on your site, call our API to pay and verify, then reveal your content. This is a minimal example:</p>
  <pre style="white-space:pre-wrap; background:rgba(10,12,18,.6); padding:12px; border-radius:10px">&lt;button id="pay" data-article="123"&gt;Pay 25¢&lt;/button&gt;
&lt;script&gt;
async function post(u,b){const r=await fetch(u,{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(b)});const j=await r.json();if(!r.ok) throw new Error(j.error||'fail');return j;}
document.getElementById('pay').addEventListener('click',async(e)=>{
  const id = parseInt(e.target.getAttribute('data-article'),10);
  const p = await post('/api/pay',{article_id:id});
  const v = await post('/api/verify',{access_token:p.access_token, article_id:id});
  if(v.valid){ document.getElementById('locked').style.display='none'; document.getElementById('unlocked').style.display='block'; }
});
&lt;/script&gt;</pre>
<script>
(function(){
  const btn = document.getElementById('bm-copy');
  const pre = document.getElementById('bm-code');
  if(btn && pre){
    btn.addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(pre.textContent || ''); alert('Copied'); }catch(e){ alert('Copy failed'); }
    });
  }
})();
</script>
</section>
{% endblock %}


